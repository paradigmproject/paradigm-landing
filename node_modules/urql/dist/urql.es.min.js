import{make as r,subscribe as t,onEnd as n,onPush as e,toPromise as o,take as i,share as u,filter as a,map as c,tap as f,merge as s,mergeMap as p,takeUntil as v,switchMap as l,fromValue as h,interval as d,makeSubject as y,onStart as m}from"wonka";import{GraphQLError as x,parse as g,print as O,visit as w,Kind as k}from"graphql";import{createContext as b,useContext as q,useRef as E,useState as N,useCallback as S,useLayoutEffect as P,useEffect as _,useMemo as j}from"react";function A(){return(A=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(r[e]=n[e])}return r}).apply(this,arguments)}var Q=function(r,t){var n="";return void 0!==r?n="[Network] "+r.message:(void 0!==t&&t.forEach(function(r){n+="[GraphQL] "+r.message+"\n"}),n.trim())},C=function(r){return"string"==typeof r?new x(r):"object"==typeof r&&r.message?new x(r.message,r.nodes,r.source,r.positions,r.path,r.originalError,r.extensions||{}):r};function I(){return this.message}var R=function(r){function t(t){var n=t.networkError,e=t.response,o=(t.graphQLErrors||[]).map(C),i=Q(n,o);r.call(this,i),this.name="CombinedError",this.message=i,this.graphQLErrors=o,this.networkError=n,this.response=e}return r&&(t.__proto__=r),(t.prototype=Object.create(r&&r.prototype)).constructor=t,t.prototype.toString=I,t}(Error),L=function(r,t){r|=0;for(var n=0,e=0|t.length;n<e;n++)r=(r<<5)+r+t.charCodeAt(n);return r},F=new Set,M=function(r){if(void 0===r)return"";if("number"==typeof r)return isFinite(r)?""+r:"null";if("object"!=typeof r)return JSON.stringify(r);if(null===r)return"null";var t="";if(Array.isArray(r)){t="[";for(var n=0,e=r.length;n<e;n++){n>0&&(t+=",");var o=M(r[n]);t+=o.length>0?o:"null"}return t+"]"}if(F.has(r))throw new TypeError("Converting circular structure to JSON");var i=Object.keys(r).sort();F.add(r),t="{";for(var u=0,a=i.length;u<a;u++){var c=i[u],f=M(r[c]);0!==f.length&&(t.length>1&&(t+=","),t+=M(c)+":"+f)}return F.delete(r),t+"}"},D=function(r){return F.clear(),M(r)},T=function(r){return t=r.replace(/[\s,]+/g," ").trim(),L(5381,t)>>>0;var t},$=Object.create(null),J=function(r,t){var n,e;return"string"==typeof r?(n=T(r),e=void 0!==$[n]?$[n]:g(r)):void 0!==r.__key?(n=r.__key,e=r):(n=T(O(r)),e=void 0!==$[n]?$[n]:r),$[n]=e,e.__key=n,{key:t?L(n,D(t))>>>0:n,query:e,variables:t||{}}},G=function(r,t){return A({},r,{context:A({},r.context,{meta:A({},r.context.meta,t)})})},z=function(r,t,n){return{operation:r,data:t.data,error:Array.isArray(t.errors)?new R({graphQLErrors:t.errors,response:n}):void 0,extensions:"object"==typeof t.extensions&&null!==t.extensions?t.extensions:void 0}},B=function(r,t,n){return{operation:r,data:void 0,error:new R({networkError:t,response:n}),extensions:void 0}},H=function(r,t){if(void 0===t&&(t=[]),Array.isArray(r))r.forEach(function(r){H(r,t)});else if("object"==typeof r&&null!==r)for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var e=r[n];"__typename"===n&&"string"==typeof e?t.push(e):"object"==typeof e&&null!==e&&H(e,t)}return t};function K(r,t,n){return n.indexOf(r)===t}var U=function(r){return H(r).filter(K)};function V(r){return"Field"===r.kind&&"__typename"===r.name.value}var W=function(r){return void 0!==r.selectionSet&&(r.selectionSet.selections.some(V)?r:A({},r,{selectionSet:A({},r.selectionSet,{selections:r.selectionSet.selections.concat([{kind:k.FIELD,name:{kind:k.NAME,value:"__typename"}}])})}))},X=function(r){return w(r,{Field:W,InlineFragment:W})};function Y(r){return r.toPromise=function(){return o(i(1)(r))},r}var Z=function(){},rr=function(r){var t=r.operationName;return"subscription"!==t&&"query"!==t};function tr(r){return""+r}var nr=function(r){var t=r.error,n={data:r.data,error:void 0};return void 0!==t&&(n.error={networkError:""+t.networkError,graphQLErrors:t.graphQLErrors.map(tr)}),n},er=function(r,t){var n=t.error,e={operation:r,data:t.data,extensions:void 0,error:void 0};return void 0!==n&&(e.error=new R({networkError:new Error(n.networkError),graphQLErrors:n.graphQLErrors})),e},or=function(r){var t={},n=function(r){return!rr(r)&&void 0!==t[r.key]};function e(r){return!n(r)}function o(r){return er(r,t[r.key])}function i(r){return n(r)}function p(r){var n=r.operation;if(!rr(n)){var e=nr(r);t[n.key]=e}}function v(r){delete t[r.operation.key]}var l=function(t){var n=t.client,l=t.forward;return function(t){var h=r&&"boolean"==typeof r.isClient?!!r.isClient:!n.suspense,d=u(t),y=l(a(e)(d)),m=c(o)(a(i)(d));return h?m=f(v)(m):y=f(p)(y),s([y,m])}};return l.restoreData=function(r){return A(t,r)},l.extractData=function(){return A({},t)},r&&r.initialState&&l.restoreData(r.initialState),l},ir=function(r){var t=r.operationName;return"mutation"!==t&&"query"!==t};function ur(r){return A({},r,{query:X(r.query)})}function ar(r){return G(r,{cacheOutcome:"miss"})}function cr(r){return ir(r)}var fr=function(r){var t=r.forward,n=r.client,e=new Map,o=Object.create(null),i=ur,p=pr(e,o,n),v=vr(e,o),l=function(r){var t=r.context.requestPolicy;return"query"===r.operationName&&"network-only"!==t&&("cache-only"===t||e.has(r.key))};function h(r){var t=e.get(r.key);return"cache-and-network"===r.context.requestPolicy&&sr(n,r),A({},t,{operation:G(r,{cacheOutcome:t?"hit":"miss"})})}function d(r){return!ir(r)&&l(r)}function y(r){r.operation&&"mutation"===r.operation.operationName?p(r):r.operation&&"query"===r.operation.operationName&&v(r)}function m(r){return!ir(r)&&!l(r)}return function(r){var n=u(r),e=c(h)(a(d)(n)),o=f(y)(t(c(ar)(s([c(i)(a(m)(n)),a(cr)(n)]))));return s([e,o])}},sr=function(r,t){return r.reexecuteOperation(A({},t,{context:A({},t.context,{requestPolicy:"network-only"})}))},pr=function(r,t,n){function e(t){if(r.has(t)){var e=r.get(t).operation;r.delete(t),sr(n,e)}}return function(r){var n=new Set;function o(r){n.add(r)}U(r.data).forEach(function(r){var n=t[r]||(t[r]=new Set);n.forEach(o),n.clear()}),n.forEach(e)}},vr=function(r,t){return function(n){var e=n.operation,o=n.data;null!=o&&(r.set(e.key,{operation:e,data:o,error:n.error}),U(n.data).forEach(function(r){(t[r]||(t[r]=new Set)).add(e.key)}))}},lr=function(r){return"subscription"===r.operationName};function hr(r){return!lr(r)}var dr=function(t){var n=t.forwardSubscription;return function(t){var e=t.client,o=t.forward;return function(t){var i=u(t),c=p(function(t){var o=t.key,u=a(function(r){return"teardown"===r.operationName&&r.key===o})(i);return v(u)(function(t){var o=n({key:t.key.toString(36),query:O(t.query),variables:t.variables,context:A({},t.context)});return r(function(r){var n=r[0],i=r[1],u=!1,a=o.subscribe({next:function(r){return n(z(t,r))},error:function(r){return n(B(t,r))},complete:function(){u||e.reexecuteOperation(A({},t,{operationName:"teardown"})),i()}});return function(){u=!0,a.unsubscribe()}})}(t))})(a(lr)(i)),f=o(a(hr)(i));return s([c,f])}}},yr=function(r){var t=r.forward;return function(r){return t(r)}},mr=function(r){var t=r.forward,n=new Set,e=function(r){var t=r.key,e=r.operationName;if("teardown"===e)return n.delete(t),!0;if("query"!==e)return!0;var o=n.has(t);return n.add(t),!o},o=function(r){n.delete(r.operation.key)};return function(r){var n=a(e)(r);return f(o)(t(n))}};function xr(r){var t=r.operationName;return"query"===t||"mutation"===t}var gr=function(r){var t=r.forward,n=xr;function e(r){return!n(r)}return function(r){var o=u(r),i=p(function(r){var t=r.key,n=a(function(r){return"teardown"===r.operationName&&r.key===t})(o);return v(n)(wr(r))})(a(n)(o)),c=t(a(e)(o));return s([i,c])}};function Or(r){return r.kind===k.OPERATION_DEFINITION&&r.name}var wr=function(t){return r(function(r){var n,e=r[0],o=r[1],i="undefined"!=typeof AbortController?new AbortController:void 0,u=t.context,a="function"==typeof u.fetchOptions?u.fetchOptions():u.fetchOptions||{},c=void 0!==(n=t.query.definitions.find(Or))&&n.name?n.name.value:null,f={query:O(t.query),variables:t.variables};null!==c&&(f.operationName=c);var s=A({body:JSON.stringify(f),method:"POST"},a,{headers:A({"content-type":"application/json"},a.headers),signal:void 0!==i?i.signal:void 0});return kr(t,s).then(function(r){void 0!==r&&e(r),o()}),function(){void 0!==i&&i.abort()}})},kr=function(r,t){var n,e=r.context;return(e.fetch||fetch)(e.url,t).then(function(r){var e=r.status;if(n=r,e<200||e>=("manual"===t.redirect?400:300))throw new Error(r.statusText);return r.json()}).then(function(t){return z(r,t,n)}).catch(function(t){if("AbortError"!==t.name)return B(r,t,n)})};function br(){return!1}function qr(r){}var Er=function(r){return a(br)(f(qr)(r))},Nr=function(r){return 1===r.length?r[0]:function(t){var n=t.client;return r.reduceRight(function(r,t){return t({client:n,forward:r})},t.forward)}},Sr=[mr,fr,gr],Pr=function(r){return new _r(r)},_r=function(r){var t=this;this.activeOperations=Object.create(null),this.createOperationContext=function(r){var n=(r||{}).requestPolicy;return void 0===n&&(n=t.requestPolicy),A({url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch},r,{requestPolicy:n})},this.createRequestOperation=function(r,n,e){return{key:n.key,query:n.query,variables:n.variables,operationName:r,context:t.createOperationContext(e)}},this.reexecuteOperation=function(r){(t.activeOperations[r.key]||0)>0&&t.dispatchOperation(r)},this.executeQuery=function(r,n){var e=t.createRequestOperation("query",r,n),o=t.executeRequestOperation(e),i=e.context.pollInterval;return i?l(function(){return o})(s([h(0),d(i)])):o},this.executeSubscription=function(r,n){var e=t.createRequestOperation("subscription",r,n);return t.executeRequestOperation(e)},this.executeMutation=function(r,n){var e=t.createRequestOperation("mutation",r,n);return t.executeRequestOperation(e)},this.url=r.url,this.fetchOptions=r.fetchOptions,this.fetch=r.fetch,this.suspense=!!r.suspense,this.requestPolicy=r.requestPolicy||"cache-first";var n=y(),e=n[1];this.operations$=n[0];var o=[],i=!1;this.dispatchOperation=function(r){if(o.push(r),!i){var t;for(i=!0;void 0!==(t=o.shift());)e(t);i=!1}},this.exchange=Nr(void 0!==r.exchanges?r.exchanges:Sr),this.results$=u(this.exchange({client:this,forward:Er})(this.operations$))};_r.prototype.onOperationStart=function(r){var t=r.key;this.activeOperations[t]=(this.activeOperations[t]||0)+1,this.dispatchOperation(r)},_r.prototype.onOperationEnd=function(r){var t=r.key,n=this.activeOperations[t]||0;(this.activeOperations[t]=n<=0?0:n-1)<=0&&this.dispatchOperation(A({},r,{operationName:"teardown"}))},_r.prototype.executeRequestOperation=function(o){var u=this,c=o.key,f=o.operationName,s=a(function(r){return r.operation.key===c})(this.results$);if("mutation"===f)return i(1)(m(function(){return u.dispatchOperation(o)})(s));var p,l=a(function(r){return"teardown"===r.operationName&&r.key===c})(this.operations$),h=n(function(){return u.onOperationEnd(o)})(m(function(){return u.onOperationStart(o)})(v(l)(s)));return this.suspense&&"subscription"!==f?(p=h,r(function(r){var o,i,u=r[0],a=r[1],c=!1,f=t(function(r){void 0===o?i=r:c||(o(r),a(),f())})(n(a)(e(u)(p)))[0];if(void 0===i)throw new Promise(function(r){o=r});return function(){c=!0,f()}})):h},_r.prototype.query=function(r,t,n){return Y(this.executeQuery(J(r,t),n))},_r.prototype.mutation=function(r,t,n){return Y(this.executeMutation(J(r,t),n))};var jr=b(Pr({url:"/graphql"})),Ar=jr.Provider,Qr=jr.Consumer,Cr=function(){return q(jr)},Ir="undefined"!=typeof window?P:_,Rr=function(r){var t=E(!1),n=N(r),e=n[0],o=n[1],i=S(function(r){if(t.current)o(r);else{var n="function"==typeof r?r(e):r;A(e,n)}},[]);function u(){t.current=!1}return Ir(function(){return t.current=!0,u},[]),[e,i]},Lr=function(r){var t=Cr(),n=Rr({fetching:!1,error:void 0,data:void 0,extensions:void 0}),e=n[1];function i(r){return e({fetching:!1,data:r.data,error:r.error,extensions:r.extensions}),r}return[n[0],S(function(n,u){e({fetching:!0,error:void 0,data:void 0,extensions:void 0});var a=J(r,n);return o(t.executeMutation(a,u||{})).then(i)},[t,r,e])]},Fr=function(r,t){var n=E(void 0);return j(function(){var e=J(r,t);return void 0!==n.current&&n.current.key===e.key?n.current:(n.current=e,e)},[r,t])},Mr=function(r,t){var n=E(Z),e=E(!1);e.current||(n.current(),n.current=r()||Z),_(function(){return e.current?r():(e.current=!0,n.current)},t)};function Dr(r){return A({},r,{fetching:!0})}function Tr(r){return A({},r,{fetching:!1})}function $r(r){return A({},r,{fetching:!1})}var Jr=function(r){var e=E(Z),o=Cr(),i=Rr({fetching:!1,data:void 0,error:void 0,extensions:void 0}),u=i[0],a=i[1],c=Fr(r.query,r.variables);function f(r){a({fetching:!1,data:r.data,error:r.error,extensions:r.extensions})}function s(){return a(Tr)}var p=S(function(i){var u;e.current(),a(Dr),u=t(f)(n(s)(o.executeQuery(c,A({requestPolicy:r.requestPolicy,pollInterval:r.pollInterval},r.context,i)))),e.current=u[0]},[r.context,r.requestPolicy,r.pollInterval,o,c,a]);function v(){return e.current()}return Mr(function(){return r.pause?(e.current(),a($r),Z):(p(),v)},[p,r.pause,a]),[u,p]};function Gr(r){return A({},r,{fetching:!0})}function zr(r){return A({},r,{fetching:!1})}function Br(r){return A({},r,{fetching:!1})}var Hr=function(r,e){var o=E(Z),i=E(e),u=Cr(),a=Rr({fetching:!1,error:void 0,data:void 0,extensions:void 0}),c=a[0],f=a[1];i.current=e;var s=Fr(r.query,r.variables);function p(r){var t=r.data,n=r.error,e=r.extensions,o=i.current;f(function(r){return{fetching:!0,data:"function"==typeof o?o(r.data,t):t,error:n,extensions:e}})}function v(){return f(zr)}var l=S(function(e){var i;o.current(),f(Gr),i=t(p)(n(v)(u.executeSubscription(s,A({},r.context,e)))),o.current=i[0]},[u,s,f,r.context]);function h(){return o.current()}return Mr(function(){return r.pause?(o.current(),f(Br),Z):(l(),h)},[l,r.pause,f]),[c,l]};function Kr(r){var t=r.children,n=Lr(r.query);return t(A({},n[0],{executeMutation:n[1]}))}function Ur(r){var t=Jr(r);return r.children(A({},t[0],{executeQuery:t[1]}))}function Vr(r){var t=Hr(r,r.handler);return r.children(A({},t[0],{executeSubscription:t[1]}))}export{_r as Client,R as CombinedError,Qr as Consumer,jr as Context,Kr as Mutation,Ar as Provider,Ur as Query,Vr as Subscription,fr as cacheExchange,Nr as composeExchanges,Pr as createClient,J as createRequest,yr as debugExchange,mr as dedupExchange,Sr as defaultExchanges,Er as fallbackExchangeIO,gr as fetchExchange,X as formatDocument,B as makeErrorResult,z as makeResult,or as ssrExchange,D as stringifyVariables,dr as subscriptionExchange,Cr as useClient,Lr as useMutation,Jr as useQuery,Hr as useSubscription};
